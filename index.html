<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Information Visualization</title>

    <!-- Mobile Specific Metas
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FONT
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

    <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="resources/libraries/skeleton/normalize.css">
    <link rel="stylesheet" href="resources/libraries/skeleton/skeleton.css">

    <!-- Default CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="resources/css/style.css">

</head>
<body>
<div class="container header">
    <div class="row">
        <div class="four columns">
            <h5 class="m0">Information Visualization</h5>
            CSCI - 628
        </div>
        <div class="eight columns text-right">
            <strong>Ashiqur Rahman</strong><br/>
            Z1874484
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="twelve column">
            <h1>Visualizing relation between misinformation and public stance on Covid-19 vaccine</h1>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="twelve columns">
            <h3>Visualizing topics</h3>
            <p>Let's analyze the topic scores to see impact of each topic over time.</p>
        </div>
        <div class="twelve columns">
            <div id="topic-visualization">

            </div>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <h3>Sentiment</h3>
            <p>The tweet users become more polarized over time as we can see in the cumulative sentiment score.</p>
        </div>
        <div class="twelve columns">
            <div id="sentiment-visualization">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="twelve columns">
            <h3>Progress</h3>
            <p>We now have all the data to implement the visualization from the <a href="update-1.html" target="_blank">concept
                design</a>. Above visualizations are prepared using d3 to implement the concept from <a href="update-2.html" target="_blank">tablau concepts</a>.</p>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="six columns">
            <h4>Project updates</h4>
            <ul>
                <li>Prepare dataset &check;</li>
                <li>Literature review &check;</li>
                <li>Finalize concept &check;</li>
                <li>Implement visualization &circledcirc;</li>
                <li>Project report &circleddash;</li>
                <li>Presentation &circleddash;</li>
            </ul>
        </div>
        <div class="six columns text-right">
            <h4>Documents</h4>
            <ul>
                <li><a href="docs/Project%20Proposal.pdf" target="_blank">Project proposal</a></li>
                <li><a href="docs/Annotated%20Bibliography.pdf" target="_blank">Bibliography</a></li>
                <li>
                    <a href="docs/A%20survey%20on%20visualization%20techniques%20to%20represent%20time-series%20data.pdf"
                       target="_blank">Literature Survey</a></li>
            </ul>
            <h4>Previous updates</h4>
            <ul>
                <li><a href="update-2.html" target="_blank">10/14/2021</a></li>
                <li><a href="update-1.html" target="_blank">10/04/2021</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="container footer">
    <div class="row">
        <div class="twelve columns">
            <p class="text-right">
                <small>
                    Information visualization project progress of Ashiqur Rahman.<br/>
                    Email: ashiqur.r@niu.edu<br/>
                    Last update: 10/28/2021
                </small>
            </p>
        </div>
    </div>
</div>
<!-- Loading D3
    -------------------------------------------------- -->
<script type="module">
    import * as d3 from "https://cdn.skypack.dev/d3@7";

    window.onload = function () {
        Promise.all( [d3.csv( "resources/data/monthly_topics.csv" ),
            d3.csv( "resources/data/user_cumulative_score.csv" )] )
            .then( createVisualization );
    };

    /**
     * Function to create the visualization
     * @param data array of CSV data elements
     */
    function createVisualization( data ) {

        // Prepare the monthly topics with appropriate type conversion
        const monthly_topics = data[0].map( ( d ) => {
            return {
                'month': new Date( '01' + d.Month.trim() ),       // Convert string months to date object
                'topic': d.Topic.trim().replaceAll( "'", '' ),    // Trim empty space and quotes
                'score': parseFloat( d.Score.trim() )             // Convert to floating point number
            }
        } );

        // Prepare the user sentiments with appropriate type conversion
        const user_sentiments = data[1].map( ( d ) => {
            return {
                'month': new Date( '01' + d.Month.trim() ),
                'created_at': new Date( d.created_at.trim() ),
                'cumulative_sentiment': parseFloat( d.cumulative_sentiment.trim() ),
                'user_screen_name': d.user_screen_name.trim()
            }
        } );
        console.log( monthly_topics );
        console.log( user_sentiments );

        // Attributes of the SVG visualization
        const attributes = {
            width: 800,
            height: 800,
            margin: {
                top: 20,
                right: 20,
                bottom: 20,
                left: 20
            },
            axis: {
                x: 100,
                y: 100
            }
        };

        // Get the unique dates from the monthly topics object
        const dates = monthly_topics.map( e => e.month )
            .filter( ( e, index, self ) =>
                self.findIndex( d => d.getTime() === e.getTime() ) === index );

        // X axis domains
        const x_domains = d3.extent( dates );
        // X axis scale
        const x_scale = d3.scaleTime()
            .domain( x_domains )
            .range( [attributes.margin.left + attributes.axis.y, attributes.width - attributes.margin.left - attributes.margin.right] );

        const x_axis = d3.axisBottom( x_scale )
            .tickFormat( d3.timeFormat( '%B %Y' ) );


        // Get the unique topics from monthly topics object
        const topics = [...new Set( monthly_topics.map( e => e.topic ) )];
        // Y axis scale
        const y_scale = d3.scaleBand()
            .range( [attributes.margin.top, attributes.height - attributes.margin.top - attributes.margin.bottom - attributes.axis.x] )
            .domain( topics )
            .padding( 1 );

        const y_axis = d3.axisLeft( y_scale );

        const topics_svg = d3.select( '#topic-visualization' )
            .append( 'svg' )
            .attr( 'width', attributes.width )
            .attr( 'height', attributes.height )
            .attr( 'viewBox', [0, 0, attributes.width, attributes.height] )
            .attr( 'style', 'max-width: 100%; height: auto; height: intrinsic;' );

        // Add X axis
        topics_svg.append( 'g' )
            .attr( 'class', 'x axis' )
            .attr( 'transform', 'translate(' + (attributes.margin.left) + ', ' + (attributes.height - attributes.margin.bottom - attributes.axis.x) + ')' )
            .call( x_axis )
            .selectAll( 'text' )
            .attr( 'y', 0 )
            .attr( 'x', -15 )
            .attr( 'dy', '.35em' )
            .attr( 'transform', 'rotate(270)' )
            .style( 'text-anchor', 'end' );

        // Add Y axis
        topics_svg.append( 'g' )
            .attr( 'class', 'y axis' )
            .attr( 'transform', 'translate(' + (attributes.margin.left + attributes.axis.x) + ', ' + attributes.margin.top + ')' )
            .call( y_axis )
            .selectAll( 'text' )
            .style( 'text-anchor', 'end' );

        // Color Scheme
        const topic_color = d3.scaleOrdinal()
            .domain( topics )
            .range( d3.schemeSet1 );

        // Add the circles
        topics_svg.append( 'g' )
            .attr( 'class', 'bubbles' )
            .selectAll( '.bubble' )
            .data( monthly_topics )
            .join( 'circle' )
            .attr( 'class', d => 'bubble bubble-' + d.topic.toLowerCase().replace( /[.\s]+/g, '-' ) )
            .attr( 'cx', d => x_scale( d.month ) )
            .attr( 'cy', d => y_scale( d.topic ) )
            .attr( 'r', d => Math.ceil( d.score * 5 ) )
            .style( 'fill', d => topic_color( d.topic ) )

        // Sentiment placeholder
        d3.selectAll('#sentiment-visualization')
            .append('svg')
            .attr( 'width', attributes.width )
            .attr( 'height', attributes.height )
            .attr( 'viewBox', [0, 0, attributes.width, attributes.height] )
            .attr( 'style', 'max-width: 100%; height: auto; height: intrinsic;' )
            .append('text')
            .text('Coming soon!')
            .attr('x', attributes.width / 2 - 50)
            .attr('y', attributes.height / 2 - 10);
    }
</script>
</body>
</html>
